# 発送メール機能 セットアップガイド

## 概要

注文後に商品を発送したら、顧客に発送完了メールを送信できる機能です。

## 必要な環境変数

### 新しく追加が必要な環境変数

```env
ADMIN_SHIPPING_PASSWORD=your-secure-password-here
```

**設定方法:**

1. **ローカル開発の場合**: `.env.local` ファイルに追加
2. **Vercelの場合**: Vercel Dashboard → Settings → Environment Variables で追加

### パスワードの設定について

- 推測されにくい安全なパスワードを設定してください
- 例: `ShipAdmin2026!` や `Atapworks-Ship-123` など

## 使い方

### 1. 管理ページにアクセス

```
https://あなたのサイト.com/admin/shipping
```

または、ローカル開発の場合:
```
http://localhost:3000/admin/shipping
```

### 2. ログイン

設定した `ADMIN_SHIPPING_PASSWORD` を入力してログインします。

### 3. 注文情報を取得

1. **注文ID（Stripe Session ID）** を入力します
   - 注文IDは、新規注文時に管理者に届くメールに記載されています
   - Stripe Dashboard でも確認できます

2. 「取得」ボタンをクリック

3. 注文情報が表示されます:
   - お客様情報（名前・メールアドレス）
   - 配送先住所
   - 注文内容（商品・数量・金額）

### 4. 発送情報を入力

- **追跡番号**: 日本郵便の追跡番号（必須）
- **お届け予定日**: 例: `2月3日（月）〜 2月5日（水）`（必須）
- **カスタムメッセージ**: お客様へのメッセージ（任意）

### 5. 発送メールを送信

「発送メールを送信」ボタンをクリックすると、お客様にメールが届きます。

## 発送メールの内容

お客様に届くメールには以下が含まれます：

- ✅ 商品発送のお知らせ
- ✅ 配送業者: 日本郵便
- ✅ 追跡番号（日本郵便の追跡ページへのリンク付き）
- ✅ お届け予定日
- ✅ カスタムメッセージ（入力した場合）
- ✅ 注文内容の確認
- ✅ 配送先住所

## 注意事項

- 発送メールは同じ注文に対して何度でも送信できます（追跡番号が変わった場合など）
- メール送信には Resend API が使用されます（既存の注文確認メールと同じ）

## トラブルシューティング

### 「注文が見つかりません」と表示される

- 注文IDが正しいか確認してください
- 注文IDは `cs_` または `cs_test_` で始まります

### 「パスワードが正しくありません」と表示される

- 環境変数 `ADMIN_SHIPPING_PASSWORD` が正しく設定されているか確認
- Vercelの場合、環境変数を追加した後に再デプロイが必要です

### メールが届かない

- `RESEND_API_KEY` が正しく設定されているか確認
- `RESEND_FROM_EMAIL` が正しく設定されているか確認
- Resend ダッシュボードでエラーログを確認

## Vercel 環境変数の追加手順

1. [Vercel Dashboard](https://vercel.com/dashboard) にログイン
2. プロジェクトを選択
3. **Settings** タブをクリック
4. 左メニューから **Environment Variables** を選択
5. 以下を追加:
   - **Key**: `ADMIN_SHIPPING_PASSWORD`
   - **Value**: 設定したいパスワード
   - **Environment**: Production, Preview, Development すべてにチェック
6. **Save** をクリック
7. **Deployments** タブに移動して、最新のデプロイを **Redeploy** する
