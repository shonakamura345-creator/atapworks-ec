# Resendのテストモード制限の理屈について

## 質問

- なぜ `onboarding@resend.dev` からは自分のメールアドレスにしか送れないのか？
- 自分のアドレスかどうかは、どうやって判定しているのか？
- カスタムドメインを検証すると、なぜ他人のメールアドレスにも送れるようになるのか？

---

## Resendのテストモードの制限の理屈

### 1. `onboarding@resend.dev` とは

`onboarding@resend.dev` は、**Resendが提供するデフォルトのテスト用ドメイン**です。

**特徴**:
- ✅ 誰でもすぐに使える（ドメイン検証不要）
- ✅ テスト目的で使用される
- ❌ **スパム防止のため、自分のメールアドレスにしか送信できない**

---

### 2. なぜ自分のメールアドレスにしか送れないのか

**理由**: **スパム防止のため**

Resendは、スパムメールの送信を防ぐために、テスト用ドメイン（`onboarding@resend.dev`）からは、**Resendアカウントに登録されているメールアドレスにしか送信できない**という制限を設けています。

**理屈**:
1. **スパム防止**: 誰でも使えるドメインから、他人のメールアドレスに送信できると、スパムメールが大量に送信される可能性がある
2. **アカウントの信頼性**: Resendアカウントに登録されているメールアドレスは、本人確認が済んでいる
3. **テスト目的**: テスト用ドメインは、あくまでテスト目的で使用される

---

### 3. 自分のメールアドレスかどうかの判定方法

**判定方法**: **Resendアカウントに登録されているメールアドレス**

Resendは、以下の方法で「自分のメールアドレス」を判定しています：

1. **Resendアカウントに登録されているメールアドレス**
   - Resendにサインアップした際に使用したメールアドレス
   - アカウント設定で登録されているメールアドレス

2. **送信先のメールアドレスが、Resendアカウントに登録されているメールアドレスと一致するか確認**
   - 一致する場合: 送信可能
   - 一致しない場合: 送信不可（エラーが発生）

**現在の状況**:
- Resendアカウントに登録されているメールアドレス: `sho.nakamura345@gmail.com`（推測）
- 顧客へのメール: `sho.nakamura345@gmail.com` → 送信成功（自分のメールアドレス）
- 管理者へのメール: `info.shokenchikushi@gmail.com` → 送信失敗（他人のメールアドレス）

---

### 4. カスタムドメインを検証すると、なぜ他人のメールアドレスにも送れるようになるのか

**理由**: **ドメインの所有権を確認できるため**

カスタムドメイン（`atapworks.co.jp`）を検証すると：

1. **ドメインの所有権を確認**
   - DNSレコードを設定することで、そのドメインを所有していることを証明できる
   - ドメインの所有者は、そのドメインからメールを送信する権利がある

2. **スパム防止の制限が解除される**
   - ドメインの所有者が確認できれば、スパム防止の制限が解除される
   - 他人のメールアドレスにも送信可能になる

3. **プロフェッショナルなメールアドレスから送信できる**
   - `info@atapworks.co.jp` から送信できる
   - 顧客への信頼性が向上

---

## 具体例

### 現在の状況（`onboarding@resend.dev` を使用）

**送信元**: `onboarding@resend.dev`

- ✅ `sho.nakamura345@gmail.com` に送信 → 成功（Resendアカウントに登録されているメールアドレス）
- ❌ `info.shokenchikushi@gmail.com` に送信 → 失敗（他人のメールアドレス）

**理由**: Resendアカウントに登録されているメールアドレスは `sho.nakamura345@gmail.com` のみ

---

### ドメイン検証後（`info@atapworks.co.jp` を使用）

**送信元**: `info@atapworks.co.jp`

- ✅ `sho.nakamura345@gmail.com` に送信 → 成功
- ✅ `info.shokenchikushi@gmail.com` に送信 → 成功（ドメインが検証されているため）

**理由**: ドメインの所有権が確認できれば、スパム防止の制限が解除される

---

## まとめ

### なぜ自分のメールアドレスにしか送れないのか

1. **スパム防止のため**
   - 誰でも使えるドメインから、他人のメールアドレスに送信できると、スパムメールが大量に送信される可能性がある

2. **Resendアカウントに登録されているメールアドレスにしか送信できない**
   - Resendアカウントに登録されているメールアドレスは、本人確認が済んでいる
   - そのメールアドレスにしか送信できない

### 自分のメールアドレスかどうかの判定方法

- **Resendアカウントに登録されているメールアドレス**と一致するか確認
- 一致する場合: 送信可能
- 一致しない場合: 送信不可

### カスタムドメインを検証すると、なぜ他人のメールアドレスにも送れるようになるのか

1. **ドメインの所有権を確認できる**
   - DNSレコードを設定することで、そのドメインを所有していることを証明できる

2. **スパム防止の制限が解除される**
   - ドメインの所有者が確認できれば、スパム防止の制限が解除される
   - 他人のメールアドレスにも送信可能になる

---

## 次のステップ

1. ⏳ **ドメインの検証を待つ**（数分〜数時間）
2. ⏳ **RESEND_FROM_EMAILを `info@atapworks.co.jp` に変更**
3. ⏳ **再デプロイ**
4. ⏳ **テスト購入を実行**
5. ⏳ **管理者メール（`info.shokenchikushi@gmail.com`）が届くか確認**

まず、**Resend Dashboardでドメインの検証状況を確認**してください。

検証が完了したら、`RESEND_FROM_EMAIL` を `info@atapworks.co.jp` に変更して、再デプロイしてください。

これで、`info.shokenchikushi@gmail.com` に管理者メールが送信されるようになります。

